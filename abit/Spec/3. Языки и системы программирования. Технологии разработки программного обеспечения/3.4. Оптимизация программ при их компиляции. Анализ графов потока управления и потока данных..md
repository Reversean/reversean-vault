# Оптимизация программ при компиляции

Оптимизация программного кода в процессе компиляции — это этап преобразования промежуточного представления (IR) с целью повышения эффективности исполняемого кода при сохранении его семантической эквивалентности. Современные компиляторы применяют широкий спектр архитектурно-независимых и зависимых техник, многие из которых основаны на графовых представлениях потока управления и потока данных.

---

## Оптимизация базовых блоков

**Базовый блок** — это линейная последовательность инструкций без ветвлений, за исключением начала и конца блока. Оптимизации в пределах одного базового блока включают:

- **Удаление мёртвого кода** — устранение инструкций, результаты которых не используются.
    
- **Свёртка констант** — вычисление выражений во время компиляции.
    
- **Объединение выражений** — устранение дублирующихся вычислений.
    
- **Пропаганда копий** — подстановка переменных их значениями.
    

Эти техники реализуются с опорой на анализ доступных выражений и живости переменных (liveness analysis).

---

## Оптимизация циклов

Циклы — основное место потребления ресурсов при выполнении программ. Оптимизации, применяемые к ним:

- **Перемещение инвариантов за пределы цикла** (loop-invariant code motion)
    
- **Разворачивание цикла** (loop unrolling) — уменьшает количество итераций и накладных расходов на управление циклом
    
- **Удаление мёртвых циклов**
    
- **Преобразование индексов** — упрощение арифметики обращения к элементам массива
    

Для этих преобразований требуется построение **графа потока управления** (CFG), анализ доминаторов, определение тел цикла и зависимостей между операциями.

---

## Распределение регистров

Распределение регистров — задача размещения временных переменных в ограниченном числе аппаратных регистров. Реализуется как задача раскраски графа:

- Строится **интерференционный граф**, в котором вершины соответствуют переменным, а рёбра — одновременному существованию значений.
    
- Граф раскрашивается минимальным числом цветов, соответствующим количеству доступных регистров.
    

Также применяются эвристики и техники **регистрового пролива** (spilling), если количество переменных превышает число доступных регистров.

---

## Анализ графов потока управления (CFG)

**CFG (Control Flow Graph)** — ориентированный граф, в котором вершины — базовые блоки, а рёбра — переходы управления. Используется для:

- Построения множества достижимых блоков
    
- Выделения циклов (естественных, вложенных)
    
- Поиска доминаторов и пост-доминаторов
    

CFG служит основой для всех форм глобального анализа и оптимизации.

---

## Анализ потока данных

Цель анализа потока данных — формальное определение свойств значений переменных на различных путях выполнения. Используются алгоритмы слияния информации из различных путей (dataflow equations):

- **Анализ живости** — используется при распределении регистров
    
- **Доступные выражения** — применяется для устранения дублирующих вычислений
    
- **Определённые/неопределённые переменные** — контроль корректности кода
    

Такие анализы реализуются как системы уравнений над множествами, решаемые методом итеративного приближения до достижения фиксированной точки.

---

# Связанные понятия

- [Базовый блок]
    
- [CFG]
    
- [Интерференционный граф]
    
- [Регистровая раскраска]
    
- [Анализ живости]
    
- [Loop unrolling]
    
- [Loop-invariant motion]
    
- [Dead code elimination]
    
- [Dataflow analysis]
    
- [Оптимизация компилятора]